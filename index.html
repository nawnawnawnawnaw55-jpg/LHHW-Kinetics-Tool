<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAETANO LHHW KINETICS & GRAPHS</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%234ade80' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M8 2v20h8V2H8z'/><path d='M8 6h8'/><path d='M8 10h8'/><path d='M8 14h8'/><path d='M8 18h8'/><path d='M4 14h4'/><path d='M16 6h4'/></svg>">
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --accent-green: #4ade80;
            --pastel-pink: #fbcfe8;
            --input-bg: #2d2d2d;
            --scrollbar-gray: #555555;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px; 
            margin: 0;
            min-height: 100vh;
            box-sizing: border-box;
            overflow-y: auto; 
        }

        .container { 
            width: 100%; 
            max-width: 900px; 
            display: flex; 
            flex-direction: column; 
            background-color: var(--bg-color);
            position: relative;
        }

        .title-group { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .title-icon { width: 32px; height: 32px; stroke: var(--accent-green); }
        h2 { color: var(--accent-green); margin: 0; text-transform: uppercase; letter-spacing: 3px; font-weight: 900; }

        .tabs { display: flex; border-bottom: 2px solid var(--input-bg); margin-bottom: 20px; flex-wrap: wrap; gap: 5px; }
        .tab-btn { background: transparent; color: var(--scrollbar-gray); border: none; padding: 10px 15px; font-size: 13px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: all 0.3s; border-bottom: 3px solid transparent; flex-grow: 1; text-align: center;}
        .tab-btn:hover { color: var(--pastel-pink); }
        .tab-btn.active { color: var(--accent-green); border-bottom: 3px solid var(--accent-green); }

        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .input-wrapper { display: flex; flex-direction: column; }
        
        .label-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
        .label-left { display: flex; align-items: center; }
        .label-text { font-size: 12px; color: var(--accent-green); font-weight: bold; letter-spacing: 1px; display: inline; text-transform: uppercase;}
        .label-text sub { font-size: 9px; vertical-align: bottom; margin-left: 1px; text-transform: none; }
        .hint { font-size: 10px; color: #888; font-weight: normal; margin-bottom: 2px;}

        .styled-input { width: 100%; background-color: var(--input-bg); border: 2px solid var(--accent-green); border-radius: 8px; color: white; padding: 15px; font-family: 'Consolas', monospace; font-size: 14px; outline: none; box-sizing: border-box; transition: border-color 0.3s ease; }
        .styled-input:focus { border-color: var(--pastel-pink); box-shadow: 0 0 10px rgba(251, 207, 232, 0.2); }

        .toggle-btn { background: transparent; border: 1px solid var(--pastel-pink); color: var(--pastel-pink); font-size: 10px; padding: 3px 8px; cursor: pointer; border-radius: 4px; text-transform: uppercase; font-weight: bold; transition: all 0.2s; margin-left: 10px;}
        .toggle-btn:hover { background: var(--pastel-pink); color: var(--bg-color); }

        .tooltip { position: relative; display: inline-flex; align-items: center; justify-content: center; width: 14px; height: 14px; background-color: transparent; border: 1px solid var(--pastel-pink); color: var(--pastel-pink); border-radius: 4px; font-size: 10px; font-weight: bold; cursor: help; margin-left: 8px; font-family: sans-serif; text-transform: none; letter-spacing: 0; }
        .tooltip.out-tip { border-color: var(--accent-green); color: var(--accent-green); }
        .tooltip .tooltiptext { visibility: hidden; width: 220px; background-color: var(--bg-color); color: #fff; text-align: left; border-radius: 6px; padding: 10px; position: absolute; z-index: 100; bottom: 150%; left: 50%; transform: translateX(-50%); border: 1px solid var(--pastel-pink); font-size: 11px; font-weight: normal; opacity: 0; transition: opacity 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.8); line-height: 1.4; pointer-events: none; }
        .tooltip.out-tip .tooltiptext { border-color: var(--accent-green); }
        .tooltip .tooltiptext::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--pastel-pink) transparent transparent transparent; }
        .tooltip.out-tip .tooltiptext::after { border-color: var(--accent-green) transparent transparent transparent; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        .copyable { cursor: pointer; transition: opacity 0.2s; border-bottom: 1px dashed transparent; display: inline-block;}
        .copyable:hover { opacity: 0.7; border-bottom: 1px dashed currentColor; }

        .output-box { background-color: var(--input-bg); border: 2px dashed var(--pastel-pink); border-radius: 12px; padding: 20px; margin-top: 20px; }
        .output-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: 'Consolas', monospace; }
        .output-row:last-child { border-bottom: none; }
        .out-label { color: var(--text-color); font-size: 13px; font-weight: bold; display: flex; align-items: center;}
        
        .out-value-container { display: flex; align-items: center; gap: 8px; }
        .out-value { color: var(--accent-green); font-size: 16px; font-weight: bold; }
        .out-rate { color: var(--pastel-pink); font-size: 22px; font-weight: 900; }
        .unit-text { font-size: 12px; color: #888; }

        .graph-container { width: 100%; height: 400px; margin-bottom: 20px; border-radius: 8px; overflow: hidden; border: 1px solid var(--input-bg); }

        details { margin-top: 20px; background-color: var(--input-bg); border: 1px solid var(--scrollbar-gray); border-radius: 8px; padding: 15px; }
        summary { color: var(--accent-green); font-weight: bold; text-transform: uppercase; font-size: 12px; cursor: pointer; letter-spacing: 1px; outline: none; }
        .math-content { margin-top: 15px; font-size: 14px; color: #ccc; overflow-x: auto; }

        .aspen-section { margin-bottom: 30px; }
        .aspen-section-title { color: white; border-bottom: 2px solid var(--scrollbar-gray); padding-bottom: 8px; margin-bottom: 15px; font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }
        .aspen-card { background-color: var(--input-bg); padding: 20px; border-radius: 8px; border-left: 4px solid var(--pastel-pink); margin-bottom: 15px;}
        .aspen-title { color: var(--pastel-pink); font-size: 14px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 5px;}
        .aspen-code { font-family: 'Consolas', monospace; color: var(--accent-green); font-size: 13px; margin-bottom: 8px; background: rgba(74, 222, 128, 0.1); padding: 8px 12px; border-radius: 4px; display: inline-block;}
        .aspen-list { font-size: 13px; color: #e0e0e0; line-height: 1.8; margin-top: 10px; list-style-type: none; padding: 0;}
        .aspen-list li { margin-bottom: 8px; }
        .aspen-val { color: var(--accent-green); font-weight: bold; font-family: 'Consolas', monospace; background: #1a1a1a; padding: 2px 6px; border-radius: 4px; border: 1px solid #333;}
        .aspen-instruction { font-size: 13px; color: #ccc; margin-bottom: 10px; line-height: 1.5; }
        .aspen-path { font-family: 'Consolas', monospace; background: #111; padding: 3px 6px; border-radius: 4px; color: var(--pastel-pink); font-size: 12px; }

        .explanation-text { font-size: 14px; color: #ccc; line-height: 1.6; margin-bottom: 15px; }
        .explanation-highlight { color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="title-group">
            <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v20h8V2H8z"/><path d="M8 6h8"/><path d="M8 10h8"/><path d="M8 14h8"/><path d="M8 18h8"/><path d="M4 14h4"/><path d="M16 6h4"/></svg>
            <h2>LHHW KINETICS TOOL</h2>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('calc')">Point Calculator</button>
            <button class="tab-btn" onclick="switchTab('graphs')">Interactive Graphs</button>
            <button class="tab-btn" onclick="switchTab('aspen')">Detailed Aspen Guide</button>
            <button class="tab-btn" onclick="switchTab('explain')">Theory & Math Explanation</button>
        </div>

        <div id="tab-calc" class="tab-content active">
            <div class="grid-layout">
                <div class="input-wrapper">
                    <div class="label-row">
                        <div class="label-left">
                            <span class="label-text">Temp</span>
                            <div class="tooltip">?<span class="tooltiptext">The operating temperature at a specific physical point in the reactor. Higher temps increase forward rate (k) but lower equilibrium conversion.</span></div>
                            <button class="toggle-btn" id="unitToggle" onclick="toggleTemp()">Using: °C</button>
                        </div>
                    </div>
                    <input type="number" id="temp" class="styled-input" value="60" oninput="updateAll()">
                </div>
                <div class="input-wrapper">
                    <div class="label-row">
                        <div class="label-left">
                            <span class="label-text">C<sub>Methanol</sub></span>
                            <div class="tooltip">?<span class="tooltiptext">The molar concentration of Methanol at this specific point in the catalyst bed. Highly polar; strongly adsorbs to Amberlyst-15 sites.</span></div>
                        </div>
                        <span class="hint">(kmol/m³ or mol/L)</span>
                    </div>
                    <input type="number" id="c_methanol" class="styled-input" value="1.5" oninput="updateAll()">
                </div>
                <div class="input-wrapper">
                    <div class="label-row">
                        <div class="label-left">
                            <span class="label-text">C<sub>Isobutene</sub></span>
                            <div class="tooltip">?<span class="tooltiptext">The molar concentration of Isobutene at this exact point in the reactor. Other non-reactive components are considered inert.</span></div>
                        </div>
                        <span class="hint">(kmol/m³ or mol/L)</span>
                    </div>
                    <input type="number" id="c_isobutene" class="styled-input" value="1.5" oninput="updateAll()">
                </div>
                <div class="input-wrapper">
                    <div class="label-row">
                        <div class="label-left">
                            <span class="label-text">C<sub>Methyl tert-butyl ether</sub></span>
                            <div class="tooltip">?<span class="tooltiptext">The concentration of product at this point. As this builds up further down the reactor, it pushes the equilibrium backward.</span></div>
                        </div>
                        <span class="hint">(kmol/m³ or mol/L)</span>
                    </div>
                    <input type="number" id="c_methyl_tert_butyl_ether" class="styled-input" value="0.2" oninput="updateAll()">
                </div>
            </div>

            <div class="output-box">
                <div class="output-row">
                    <span class="out-label">Aspen Reaction Rate (r)
                        <div class="tooltip out-tip">?<span class="tooltiptext">The instantaneous reaction speed right at the point where these concentrations exist. Formatted for Aspen LHHW input units.</span></div>
                    </span>
                    <div class="out-value-container">
                        <span class="out-rate copyable" id="out_r_aspen" onclick="copyVal(this)" title="Click to copy exact standard value">0.0000</span>
                        <span class="unit-text">kmol / (kg<sub>cat</sub> &middot; hr)</span>
                    </div>
                </div>
                <div class="output-row">
                    <span class="out-label">Caetano Forward Rate Const (k)
                        <div class="tooltip out-tip">?<span class="tooltiptext">The forward kinetic rate constant calculated using the Arrhenius equation. Driven entirely by Temperature.</span></div>
                    </span>
                    <div class="out-value-container">
                        <span class="out-value copyable" id="out_k" onclick="copyVal(this)" title="Click to copy exact standard value">0.0000</span>
                    </div>
                </div>
                <div class="output-row">
                    <span class="out-label">Adsorption Ratio (D)
                        <div class="tooltip out-tip">?<span class="tooltiptext">The lumped parameter accounting for Methyl tert-butyl ether actively competing with Methanol for physical space on the catalyst sites.</span></div>
                    </span>
                    <div class="out-value-container">
                        <span class="out-value copyable" id="out_d" onclick="copyVal(this)" title="Click to copy exact standard value">0.0000</span>
                    </div>
                </div>
                <div class="output-row">
                    <span class="out-label">Equilibrium Const (K<sub>eq</sub>)
                        <div class="tooltip out-tip">?<span class="tooltiptext">The thermodynamic limit of the reaction. Because this synthesis is exothermic, Keq drops as temp rises. This uses the exact A and B liquid-phase inputs.</span></div>
                    </span>
                    <div class="out-value-container">
                        <span class="out-value copyable" id="out_keq" onclick="copyVal(this)" title="Click to copy exact standard value">0.0000</span>
                    </div>
                </div>
            </div>

            <details>
                <summary>View Caetano (1994) Mathematical Model</summary>
                <div class="math-content">
                    <p><strong>Overall Rate (Rideal-Eley):</strong></p>
                    <p>$$ r = k \frac{C_{\text{Isobutene}} C_{\text{Methanol}} - (C_{\text{Methyl tert-butyl ether}} / K_{eq})}{C_{\text{Methanol}} + D \cdot C_{\text{Methyl tert-butyl ether}}} $$</p>
                    <p><strong>Constants (from Literature):</strong></p>
                    <p>$$ k = 8.97 \times 10^{20} \exp\left(\frac{-15660}{T}\right) $$</p>
                    <p>$$ D = 1.168 \times 10^{10} \exp\left(\frac{-9241.7}{T}\right) $$</p>
                    <p>$$ \ln(K_{eq}) = -8.06 + \frac{6820}{T} $$</p>
                </div>
            </details>
        </div>

        <div id="tab-graphs" class="tab-content">
            <p style="font-size: 12px; color: var(--scrollbar-gray); margin-top: 0;">Hover over the plot lines for a vertical trace. <strong>Zoom in by dragging a box over the graph to dynamically generate highly granular data points within that view.</strong> Double-click to zoom out.</p>
            
            <div id="plot_temp" class="graph-container"></div>
            <div id="plot_concentration" class="graph-container"></div>
        </div>

        <div id="tab-aspen" class="tab-content">
            <p class="aspen-instruction">This layout exactly matches the Aspen Plus LHHW module interface. <em>(Click any green value to copy the exact unformatted number to the clipboard)</em>.</p>
            
            <div class="aspen-section">
                
                <div class="aspen-card">
                    <div class="aspen-title">Main Kinetic Window</div>
                    <ul class="aspen-list">
                        <li><strong>Reacting Phase:</strong> <code>Liquid</code></li>
                        <li><strong>Rate Basis:</strong> <code>Cat Weight</code></li>
                        <li><strong>k:</strong> <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="3229200000000000000000000" title="Click to copy">3.2292e+24</span></li>
                        <li><strong>n:</strong> <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span></li>
                        <li><strong>E:</strong> <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="130197240" title="Click to copy">130197240</span> <span style="color:#888;">(J/kmol)</span></li>
                        <li><strong>T<sub>o</sub>:</strong> <em>Leave blank</em></li>
                    </ul>
                </div>

                <div class="aspen-card">
                    <div class="aspen-title">Solids Tab</div>
                    <ul class="aspen-list">
                        <li><strong>For liquid or vapor component:</strong> <code>Reacting phase only</code></li>
                        <li><strong>For solid component:</strong> <code>Solid phase only</code></li>
                        <li><strong>Solid component found in:</strong> <code>All solid substreams</code></li>
                    </ul>
                </div>

                <div class="aspen-card">
                    <div class="aspen-title">Driving Force Tab</div>
                    <ul class="aspen-list">
                        <li><strong>[C<sub>i</sub>] basis:</strong> <code>Molarity</code></li>
                    </ul>
                    
                    <p class="aspen-instruction" style="color:var(--pastel-pink); font-weight:bold; margin-top:15px;">&rarr; Enter term: Term 1 (Forward Reaction)</p>
                    <ul class="aspen-list">
                        <li><strong>Concentration exponents for reactants:</strong> METHANOL = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span>, ISOBUT = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span></li>
                        <li><strong>Concentration exponents for products:</strong> MTBE = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span></li>
                        <li><strong>Coefficients for driving force constant:</strong>
                            <div class="tooltip out-tip" style="margin-left: 5px; margin-bottom: 2px;">?<span class="tooltiptext">Setting these coefficients to 0 makes this term's multiplier equal to e^0 = 1. The overall rate constant (k) defined in the main window already calculates the forward reaction's temperature dependence.</span></div><br>
                            A = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            B = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            C = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            D = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>
                        </li>
                    </ul>

                    <p class="aspen-instruction" style="color:var(--pastel-pink); font-weight:bold; margin-top:15px;">&rarr; Enter term: Term 2 (Backward / K<sub>eq</sub>)</p>
                    <ul class="aspen-list">
                        <li><strong>Concentration exponents for products:</strong> MTBE = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span></li>
                        <li><strong>Coefficients for driving force constant:</strong> 
                            A = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="8.06" title="Click to copy">8.06</span>, 
                            B = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="-6820" title="Click to copy">-6820</span>, 
                            C = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            D = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>
                        </li>
                    </ul>
                </div>

                <div class="aspen-card">
                    <div class="aspen-title">Adsorption Tab</div>
                    <ul class="aspen-list">
                        <li><strong>Adsorption expression exponent:</strong> <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span></li>
                    </ul>
                    
                    <p class="aspen-instruction" style="margin-top:15px;"><strong>Concentration Exponents Table:</strong></p>
                    <ul class="aspen-list">
                        <li>Component <code>METHANOL</code> | Term No. 1: <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span> | Term No. 2: <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span></li>
                        <li>Component <code>MTBE</code> | Term No. 1: <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span> | Term No. 2: <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="1" title="Click to copy">1</span></li>
                    </ul>

                    <p class="aspen-instruction" style="margin-top:15px;"><strong>Adsorption Constants Table:</strong></p>
                    <ul class="aspen-list">
                        <li><strong>Term No. 1:</strong> 
                            <div class="tooltip out-tip" style="margin-left: 5px; margin-bottom: 2px;">?<span class="tooltiptext">Setting these coefficients to 0 makes the Methanol adsorption term equal to exactly 1. The Methyl tert-butyl ether adsorption parameter (D) in Term 2 is calculated mathematically relative to this base value.</span></div><br>
                            A = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            B = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            C = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            D = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>
                        </li>
                        <li><strong>Term No. 2:</strong> 
                            A = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="23.18091" title="Click to copy">23.18091</span>, 
                            B = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="-9241.7" title="Click to copy">-9241.7</span>, 
                            C = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>, 
                            D = <span class="aspen-val copyable" onclick="copyVal(this)" data-raw="0" title="Click to copy">0</span>
                        </li>
                    </ul>
                </div>
            </div>

        </div>

        <div id="tab-explain" class="tab-content">
            
            <div class="aspen-section">
                <div class="aspen-section-title">1. Introduction to the LHHW Model</div>
                <p class="explanation-text">The Langmuir-Hinshelwood-Hougen-Watson (LHHW) model characterizes reactions occurring on solid catalysts, such as an Amberlyst-15 resin. Before molecules can chemically react, they must first adsorb onto an active acid site located on the solid structure.</p>
                <p class="explanation-text">To model this behavior, the master equation is divided into three distinct physical concepts:</p>
                
                <div class="aspen-code" style="display:block; text-align:center; font-size:16px; padding: 15px;">
                    $$ r = \frac{\text{[Kinetic Factor]} \times \text{[Driving Force]}}{\text{[Adsorption Expression]}} $$
                </div>

                <ul class="aspen-list" style="margin-top: 15px;">
                    <li><span class="explanation-highlight">Kinetic Factor:</span> Driven by temperature. Higher temperatures provide molecules with more kinetic energy to overcome the necessary reaction barrier.</li>
                    <li><span class="explanation-highlight">Driving Force:</span> Evaluates how far the reacting system is from equilibrium. It is the forward progression of reactants minus the backward conversion of products.</li>
                    <li><span class="explanation-highlight">Adsorption Expression:</span> The denominator models molecules competing for physical space on the catalyst. Because Methanol is highly polar, it strongly occupies these active sites. If excessive Methanol or product accumulates, the active sites become obstructed, the denominator increases, and the overall reaction rate ($r$) slows down.</li>
                </ul>
                <p></p>
            </div>

            <div class="aspen-section">
                <div class="aspen-section-title">2. Main Kinetic Window Parameters</div>
                <p class="explanation-text">Aspen Plus calculates the forward kinetic factor utilizing an extended Arrhenius equation format:</p>
                
                <div class="aspen-code" style="display:block; text-align:center; font-size:14px; padding: 10px;">
                    $$ \text{Rate Constant} = k \left(\frac{T}{T_o}\right)^n \exp\left(-\frac{E}{R T}\right) $$
                </div>

                <ul class="aspen-list" style="margin-top: 15px;">
                    <li><span class="explanation-highlight">$k$ (Pre-exponential factor):</span> Represents the collision frequency of molecules with the catalyst surface.</li>
                    <li><span class="explanation-highlight">$n$ (Temperature exponent):</span> Allows for additional temperature dependence of the pre-exponential factor. It is set to $0$ when standard Arrhenius behavior is assumed.</li>
                    <li><span class="explanation-highlight">$E$ (Activation Energy):</span> The core energy barrier required to trigger the reaction, typically inputted in J/kmol.</li>
                    <li><span class="explanation-highlight">$T_o$ (Reference Temperature):</span> A reference value required if $n \neq 0$. It is left blank for standard calculations.</li>
                </ul>
            </div>

            <div class="aspen-section">
                <div class="aspen-section-title">3. Driving Force and Adsorption Coefficients</div>
                <p class="explanation-text">Aspen Plus enforces a specific mathematical structure for both the Driving Force and Adsorption tabs. It multiplies concentration variables by a temperature-dependent modifier ($K_i$), calculated as:</p>
                
                <div class="aspen-code" style="display:block; text-align:center; font-size:14px; padding: 10px;">
                    $$ K_i = \exp\left(A + \frac{B}{T} + C \ln(T) + D \cdot T\right) $$
                </div>

                <p class="explanation-text" style="margin-top: 15px;">The literature parameters map into this rigid structure through specific transformations:</p>
                
                <div class="aspen-card">
                    <div class="aspen-title">The Zero Coefficient Application</div>
                    <p class="explanation-text">For the forward reaction (Term 1), the reactants should not be multiplied by an additional variable constant, as the main Kinetic Factor already governs the forward speed. By setting $A, B, C,$ and $D$ all to $0$, Aspen calculates $K_1 = \exp(0) = 1$. The term becomes exactly $1 \times C_{\text{Methanol}} \cdot C_{\text{Isobutene}}$.</p>
                </div>

                <div class="aspen-card">
                    <div class="aspen-title">The Inversion for Equilibrium</div>
                    <p class="explanation-text">Aspen defines the Driving Force as: <code>(Term 1) - (Term 2)</code>. Therefore, Term 2 represents the backward reaction, which must be divided by the equilibrium constant ($1 / K_{eq}$).</p>
                    <p class="explanation-text">The literature states: $$ \ln(K_{eq}) = -8.06 + \frac{6820}{T} $$</p>
                    <p class="explanation-text">To divide by $K_{eq}$, the signs must be inverted mathematically:</p>
                    <div class="aspen-code" style="display:block; text-align:center; padding: 10px;">
                        $$ \frac{1}{K_{eq}} = \exp\left( -\left(-8.06 + \frac{6820}{T}\right) \right) = \exp\left( 8.06 - \frac{6820}{T} \right) $$
                    </div>
                    <p class="explanation-text" style="margin-top: 10px;">This dictates setting $A = 8.06$ and $B = -6820$ in Aspen's Term 2 Driving Force menu.</p>
                </div>

                <div class="aspen-card">
                    <div class="aspen-title">The Natural Log Transformation</div>
                    <p class="explanation-text">The Caetano literature defines the Methyl tert-butyl ether adsorption constant as: $$ \text{Adsorption Ratio} = 1.168 \times 10^{10} \exp\left(\frac{-9241.7}{T}\right) $$</p>
                    <p class="explanation-text">To fit this into Aspen's $A + B/T$ format, the natural logarithm of the pre-exponential factor is calculated:</p>
                    <div class="aspen-code" style="display:block; text-align:center; padding: 10px;">
                        $$ A = \ln(1.168 \times 10^{10}) = 23.1809 $$
                    </div>
                    <p class="explanation-text" style="margin-top: 10px;">Therefore, $A = 23.1809$ and $B = -9241.7$ are used in the Adsorption Term 2 menu.</p>
                </div>
            </div>

            <div class="aspen-section">
                <div class="aspen-section-title">4. The Point Calculation Application</div>
                <p class="explanation-text">Within a reactive distillation column, the temperature and chemical concentrations change continuously from the upper sections down to the bottom reboiler.</p>
                <p class="explanation-text">A "Point Calculation" analyzes a single, microscopic slice of the catalyst bed. It calculates the instantaneous reaction speed ($r$) precisely where specific local temperatures and local concentrations exist.</p>
                <p class="explanation-text">During a simulation, Aspen Plus evaluates this instantaneous rate at thousands of different points across the reactive stages, multiplying each point's local rate by the defined Catalyst Holdup (kg) to compute the total product synthesized.</p>
            </div>

        </div>

    </div>

    <script>
        let isCelsius = true;
        let graphsInitialized = false;

        const layoutConfig = {
            paper_bgcolor: '#1a1a1a', plot_bgcolor: '#2d2d2d',
            font: { color: '#e0e0e0' },
            hovermode: 'x unified', 
            xaxis: { gridcolor: '#444', zerolinecolor: '#444' },
            yaxis: { gridcolor: '#444', zerolinecolor: '#444' },
            margin: { l: 50, r: 20, t: 40, b: 40 }
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-' + tabId).classList.add('active');
            event.target.classList.add('active');

            if(tabId === 'graphs') updateAll(); 
        }

        function toggleTemp() {
            isCelsius = !isCelsius;
            const btn = document.getElementById('unitToggle');
            const input = document.getElementById('temp');
            let currentVal = parseFloat(input.value);

            if (!isNaN(currentVal)) {
                if (isCelsius) {
                    input.value = (currentVal - 273.15).toFixed(2);
                    btn.innerText = "Using: °C";
                } else {
                    input.value = (currentVal + 273.15).toFixed(2);
                    btn.innerText = "Using: K";
                }
            } else {
                btn.innerText = isCelsius ? "Using: °C" : "Using: K";
            }
            updateAll();
        }

        function calculateKinetics(T_kelvin, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether) {
            const k = 8.97e20 * Math.exp(-15660 / T_kelvin);
            const D = 1.168e10 * Math.exp(-9241.7 / T_kelvin);
            
            const K_eq = Math.exp(-8.06 + (6820 / T_kelvin));

            const numerator = (C_Isobutene * C_Methanol) - (C_Methyl_tert_butyl_ether / K_eq);
            const denominator = C_Methanol + (D * C_Methyl_tert_butyl_ether);
            
            let r_raw = 0;
            if (denominator > 0) r_raw = k * (numerator / denominator);
            
            const r_aspen = r_raw * 3600;
            return { r_aspen, k, D, K_eq };
        }

        function updateAll() {
            let T_input = parseFloat(document.getElementById('temp').value);
            const C_Methanol = parseFloat(document.getElementById('c_methanol').value);
            const C_Isobutene = parseFloat(document.getElementById('c_isobutene').value);
            const C_Methyl_tert_butyl_ether = parseFloat(document.getElementById('c_methyl_tert_butyl_ether').value);

            if (isNaN(T_input) || isNaN(C_Methanol) || isNaN(C_Isobutene) || isNaN(C_Methyl_tert_butyl_ether)) return;
            const T_K = isCelsius ? T_input + 273.15 : T_input;

            const pointCalc = calculateKinetics(T_K, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether);
            
            const elR = document.getElementById('out_r_aspen');
            elR.innerText = pointCalc.r_aspen.toExponential(4);
            elR.setAttribute('data-raw', pointCalc.r_aspen);

            const elK = document.getElementById('out_k');
            elK.innerText = pointCalc.k.toExponential(4);
            elK.setAttribute('data-raw', pointCalc.k);

            const elD = document.getElementById('out_d');
            elD.innerText = pointCalc.D.toFixed(4);
            elD.setAttribute('data-raw', pointCalc.D);

            const elKeq = document.getElementById('out_keq');
            elKeq.innerText = pointCalc.K_eq.toFixed(4);
            elKeq.setAttribute('data-raw', pointCalc.K_eq);

            generateGraphs(T_K, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether);
        }

        function copyVal(element) {
            const rawVal = element.getAttribute('data-raw');
            if (!rawVal) return;

            const formattedVal = Number(rawVal).toFixed(5);

            navigator.clipboard.writeText(formattedVal).then(() => {
                const originalText = element.innerText;
                
                element.innerText = "COPIED!";
                element.style.color = "var(--bg-color)";
                element.style.background = "var(--accent-green)";
                
                setTimeout(() => {
                    element.innerText = originalText;
                    element.style.color = "";
                    element.style.background = "";
                }, 800);
            });
        }

        function generateDataArrays(start, end, steps, func) {
            let x_arr = [], y_arr = [];
            let step_size = (end - start) / steps;
            for(let i = 0; i <= steps; i++) {
                let x = start + (i * step_size);
                x_arr.push(x);
                y_arr.push(func(x));
            }
            return {x: x_arr, y: y_arr};
        }

        function generateGraphs(T_K, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether) {
            if (!document.getElementById('tab-graphs').classList.contains('active')) return;

            let temp_data = generateDataArrays(20, 100, 800, (t) => calculateKinetics(t + 273.15, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether).r_aspen);
            let concentration_data = generateDataArrays(0, 5, 800, (m) => calculateKinetics(T_K, C_Methanol, C_Isobutene, m).r_aspen);

            Plotly.react('plot_temp', [{
                x: temp_data.x, y: temp_data.y, type: 'scatter', mode: 'lines',
                line: { color: '#4ade80', width: 3 }, name: 'Rate'
            }], {
                ...layoutConfig,
                title: { text: `Rate vs. Temperature (at constant C inputs)`, font: {color: '#4ade80'} },
                xaxis: { ...layoutConfig.xaxis, title: 'Temperature (°C)' },
                yaxis: { ...layoutConfig.yaxis, title: 'Reaction Rate (kmol/kg-hr)' }
            });

            Plotly.react('plot_concentration', [{
                x: concentration_data.x, y: concentration_data.y, type: 'scatter', mode: 'lines',
                line: { color: '#fbcfe8', width: 3 }, name: 'Rate'
            }], {
                ...layoutConfig,
                title: { text: `Rate vs. Methyl tert-butyl ether Concentration (The Inhibition Effect)`, font: {color: '#fbcfe8'} },
                xaxis: { ...layoutConfig.xaxis, title: 'C<sub>Methyl tert-butyl ether</sub> (kmol/m³)' },
                yaxis: { ...layoutConfig.yaxis, title: 'Reaction Rate (kmol/kg-hr)' }
            });

            if(!graphsInitialized) {
                let tempDiv = document.getElementById('plot_temp');
                let isUpdatingTemp = false;
                
                tempDiv.on('plotly_relayout', function(eventdata) {
                    if(isUpdatingTemp) return;
                    let x0 = 20, x1 = 100;
                    if(eventdata['xaxis.range[0]'] !== undefined) {
                        x0 = eventdata['xaxis.range[0]'];
                        x1 = eventdata['xaxis.range[1]'];
                    } else if (eventdata['xaxis.autorange']) { x0 = 20; x1 = 100; }
                    
                    let newData = generateDataArrays(x0, x1, 800, (t) => calculateKinetics(t + 273.15, C_Methanol, C_Isobutene, C_Methyl_tert_butyl_ether).r_aspen);
                    isUpdatingTemp = true;
                    Plotly.update('plot_temp', {x: [newData.x], y: [newData.y]});
                    isUpdatingTemp = false;
                });

                let concentrationDiv = document.getElementById('plot_concentration');
                let isUpdatingConcentration = false;
                
                concentrationDiv.on('plotly_relayout', function(eventdata) {
                    if(isUpdatingConcentration) return;
                    let x0 = 0, x1 = 5;
                    if(eventdata['xaxis.range[0]'] !== undefined) {
                        x0 = eventdata['xaxis.range[0]'];
                        x1 = eventdata['xaxis.range[1]'];
                    } else if (eventdata['xaxis.autorange']) { x0 = 0; x1 = 5; }
                    
                    let newData = generateDataArrays(x0, x1, 800, (m) => calculateKinetics(T_K, C_Methanol, C_Isobutene, m).r_aspen);
                    isUpdatingConcentration = true;
                    Plotly.update('plot_concentration', {x: [newData.x], y: [newData.y]});
                    isUpdatingConcentration = false;
                });

                graphsInitialized = true;
            }
        }

        updateAll();
    </script>
</body>
</html>
